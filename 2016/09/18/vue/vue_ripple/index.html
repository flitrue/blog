<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>vue 开发波纹点击特效组件 | 精神病聚集地</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="最近在使用 vue2 做一个新的 material ui 库，波纹点击效果在 material design 中被多次使用到，于是决定把它封装成一个公共的组件，使用时直接调用就好啦。">
<meta property="og:type" content="article">
<meta property="og:title" content="vue 开发波纹点击特效组件">
<meta property="og:url" content="http://myronliu.com/2016/09/18/vue/vue_ripple/index.html">
<meta property="og:site_name" content="精神病聚集地">
<meta property="og:description" content="最近在使用 vue2 做一个新的 material ui 库，波纹点击效果在 material design 中被多次使用到，于是决定把它封装成一个公共的组件，使用时直接调用就好啦。">
<meta property="og:updated_time" content="2016-09-18T08:36:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue 开发波纹点击特效组件">
<meta name="twitter:description" content="最近在使用 vue2 做一个新的 material ui 库，波纹点击效果在 material design 中被多次使用到，于是决定把它封装成一个公共的组件，使用时直接调用就好啦。">
  
    <link rel="alternate" href="/atom.xml" title="精神病聚集地" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/uicon.jpg">
    <h2 class="author">myron</h2>
    <h3 class="description">一只疯了的前端🐶</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>48</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags/vue"><div><strong>25</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags/vue" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-vue/vue_ripple" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/18/vue/vue_ripple/" class="article-date">
  <time class="post-time" datetime="2016-09-18T08:34:00.000Z" itemprop="datePublished">
    <span class="post-month">9月</span><br/>
    <span class="post-day">18</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      vue 开发波纹点击特效组件
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在使用 vue2 做一个新的 material ui 库，波纹点击效果在 material design 中被多次使用到，于是决定把它封装成一个公共的组件，使用时直接调用就好啦。</p>
<a id="more"></a>
<h2 id="开发之前的思考"><a href="#开发之前的思考" class="headerlink" title="开发之前的思考"></a>开发之前的思考</h2><p>常见的波纹点击效果的实现方式是监听元素的 mousedown 事件，在元素内部创建一个 <strong>波纹元素</strong> ，并调整元素的 <code>transform: scale(0);</code> 到 <code>transform: scale(1);</code>, 通过计算点击的位置来设置 <strong>波纹元素</strong> 的大小和位置，以达到波纹扩散的效果。</p>
<p>我将组件分为两个部分， <code>circleRipple.vue</code> 和 <code>TouchRipple.vue</code> 各自实现不同的功能</p>
<ol>
<li><code>circleRipple.vue</code> 波纹扩散组件，完成波纹扩散的效果</li>
<li><code>TouchRipple.vue</code> 监听 <code>mouse</code> 和 <code>touch</code> 相关事件，控制  <code>circleRipple</code> 的显示，位置。</li>
</ol>
<h2 id="circleRipple-vue"><a href="#circleRipple-vue" class="headerlink" title="circleRipple.vue"></a>circleRipple.vue</h2><p><code>circleRipple</code> 需要完成波纹扩展的效果，而且可以从外部控制它的大小和位置, 所以利用 <code>vue</code> 的 <code>transition</code> 动画完成效果, 提供 <code>mergeStyle</code> 、 <code>color</code> 、<code>opacity</code> 参数来从外部控制它的样式。实现代码如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"mu-ripple"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mu-circle-ripple"</span> <span class="attr">:style</span>=<span class="string">"styles"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="keyword">import</span> &#123;merge&#125; <span class="keyword">from</span> <span class="string">'../utils'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">props</span>: &#123;</div><div class="line">    <span class="attr">mergeStyle</span>: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">Object</span>,</div><div class="line">      <span class="keyword">default</span> () &#123;</div><div class="line">        <span class="keyword">return</span> &#123;&#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">color</span>: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">      <span class="attr">default</span>: <span class="string">''</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">opacity</span>: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">Number</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">computed</span>: &#123;</div><div class="line">    styles () &#123;</div><div class="line">      <span class="keyword">return</span> merge(&#123;&#125;, &#123;<span class="attr">color</span>: <span class="keyword">this</span>.color, <span class="attr">opacity</span>: <span class="keyword">this</span>.opacity&#125;, <span class="keyword">this</span>.mergeStyle)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></div><div class="line">@<span class="keyword">import</span> <span class="string">"../styles/import.less"</span>;</div><div class="line"><span class="selector-class">.mu-circle-ripple</span>&#123;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">pointer-events</span>: none;</div><div class="line">  <span class="attribute">user-select</span>: none;</div><div class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</div><div class="line">  <span class="attribute">background-color</span>: currentColor;</div><div class="line">  <span class="attribute">background-clip</span>: padding-box;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">0.1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.mu-ripple-enter-active</span>, <span class="selector-class">.mu-ripple-leave-active</span>&#123;</div><div class="line">  <span class="attribute">transition</span>: transform <span class="number">1s</span> @easeOutFunction, opacity <span class="number">2s</span> @easeOutFunction;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.mu-ripple-enter</span> &#123;</div><div class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(0);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.mu-ripple-leave-active</span>&#123;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">0</span> <span class="meta">!important</span>;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>vue2 对于动画方面做了比较大的修改，除了把指令换成组件外，它还可以完成更复杂的动画效果，具体可以看这里 <a href="http://rc.vuejs.org/guide/transitions.html" target="_blank" rel="external">vue2 transition</a></p>
</blockquote>
<h2 id="TouchRipple-vue"><a href="#TouchRipple-vue" class="headerlink" title="TouchRipple.vue"></a>TouchRipple.vue</h2><p><code>TouchRipple</code> 需要控制 <code>circleRipple</code> 的显示。完成以下内容：</p>
<ol>
<li>监听 <code>mouse</code> 和 <code>touch</code> 相关事件， 控制 <code>circleRipple</code> 的显示。</li>
<li>通过点击事件 event 对象， 计算出 <code>circleRipple</code> 的大小和位置</li>
<li>如果频繁点击可能出现多个 <code>circleRipple</code></li>
</ol>
<h3 id="首先，基本模板-数据模型"><a href="#首先，基本模板-数据模型" class="headerlink" title="首先，基本模板 + 数据模型"></a>首先，基本模板 + 数据模型</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--最外层用div包裹--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">mousedown</span>=<span class="string">"handleMouseDown"</span> @<span class="attr">mouseup</span>=<span class="string">"end()"</span> @<span class="attr">mouseleave</span>=<span class="string">"end()"</span> @<span class="attr">touchstart</span>=<span class="string">"handleTouchStart"</span>  @<span class="attr">touchend</span>=<span class="string">"end()"</span> @<span class="attr">touchcancel</span>=<span class="string">"end()"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--外层包裹防止波纹溢出--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">"style"</span> <span class="attr">ref</span>=<span class="string">"holder"</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--多个波纹用 v-for 控制--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">circle-ripple</span> <span class="attr">:key</span>=<span class="string">"ripple.key"</span> <span class="attr">:color</span>=<span class="string">"ripple.color"</span> <span class="attr">:opacity</span>=<span class="string">"ripple.opacity"</span> <span class="attr">:merge-style</span>=<span class="string">"ripple.style"</span> <span class="attr">v-for</span>=<span class="string">"ripple in ripples"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle-ripple</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--利用slot分发实际内容--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="keyword">import</span> circleRipple <span class="keyword">from</span> <span class="string">'./circleRipple'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">props</span>: &#123;</div><div class="line">    <span class="comment">// 是否从中间扩散，设为false会从点击处扩散</span></div><div class="line">    centerRipple: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</div><div class="line">      <span class="attr">default</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 外层包裹的样式</span></div><div class="line">    style: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">Object</span>,</div><div class="line">      <span class="keyword">default</span> () &#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">          <span class="attr">height</span>: <span class="string">'100%'</span>,</div><div class="line">          <span class="attr">width</span>: <span class="string">'100%'</span>,</div><div class="line">          <span class="attr">position</span>: <span class="string">'absolute'</span>,</div><div class="line">          <span class="attr">top</span>: <span class="string">'0'</span>,</div><div class="line">          <span class="attr">left</span>: <span class="string">'0'</span>,</div><div class="line">          <span class="attr">overflow</span>: <span class="string">'hidden'</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 波纹颜色</span></div><div class="line">    color: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">      <span class="attr">default</span>: <span class="string">''</span></div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 波纹透明度</span></div><div class="line">    opacity: &#123;</div><div class="line">      <span class="attr">type</span>: <span class="built_in">Number</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  data () &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">nextKey</span>: <span class="number">0</span>, <span class="comment">// 记录下一个波纹元素的key值， 相当于uuid，不设置的话会使动画失效</span></div><div class="line">      ripples: [] <span class="comment">// 波纹元素参数数组</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  mounted () &#123;</div><div class="line">    <span class="keyword">this</span>.ignoreNextMouseDown = <span class="literal">false</span> <span class="comment">// 防止既有 touch 又有 mouse点击的情况</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">methods</span>: &#123;</div><div class="line">    start (event, isRippleTouchGenerated) &#123;</div><div class="line">      <span class="comment">// 开始波纹效果</span></div><div class="line">    &#125;,</div><div class="line">    end () &#123;</div><div class="line">      <span class="comment">// 结束波纹效果</span></div><div class="line">    &#125;,</div><div class="line">    handleMouseDown (event) &#123;</div><div class="line">      <span class="comment">// 监听 鼠标单击</span></div><div class="line">    &#125;,</div><div class="line">    handleTouchStart (event) &#123;</div><div class="line">      <span class="comment">// 监听 touchstart 方法</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">components</span>: &#123;</div><div class="line">    <span class="string">'circle-ripple'</span>: circleRipple</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="开始和结束波纹效果"><a href="#开始和结束波纹效果" class="headerlink" title="开始和结束波纹效果"></a>开始和结束波纹效果</h3><p>增加一个波纹元素只需要在 <strong>ripple</strong> 增加一个 object 即可，不同的是当需要从点击处扩展时，需要计算一下波纹元素的大小和位置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// isRippleTouchGenerated 是否是touch 事件开始的</span></div><div class="line">  start (event, isRippleTouchGenerated) &#123;</div><div class="line">    <span class="comment">// 过滤 touchstart 和 mousedown 同时存在的情况</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.ignoreNextMouseDown &amp;&amp; !isRippleTouchGenerated) &#123;</div><div class="line">      <span class="keyword">this</span>.ignoreNextMouseDown = <span class="literal">false</span></div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 添加一个 波纹元素组件</span></div><div class="line">    <span class="keyword">this</span>.ripples.push(&#123;</div><div class="line">      <span class="attr">key</span>: <span class="keyword">this</span>.nextKey++, </div><div class="line">      <span class="attr">color</span>: <span class="keyword">this</span>.color,</div><div class="line">      <span class="attr">opacity</span>: <span class="keyword">this</span>.opacity,</div><div class="line">      <span class="attr">style</span>: <span class="keyword">this</span>.centerRipple ? &#123;&#125; : <span class="keyword">this</span>.getRippleStyle(event) <span class="comment">// 不是从中心扩展的需要计算波纹元素的位置</span></div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">this</span>.ignoreNextMouseDown = isRippleTouchGenerated</div><div class="line"> &#125;,</div><div class="line"> end () &#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.ripples.length === <span class="number">0</span>) <span class="keyword">return</span></div><div class="line">   <span class="keyword">this</span>.ripples.splice(<span class="number">0</span>, <span class="number">1</span>) <span class="comment">// 删除一个波纹元素</span></div><div class="line">   <span class="keyword">this</span>.stopListeningForScrollAbort() <span class="comment">// 结束 touch 滚动的处理</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为 vue2 基于 Virtual DOM 的， 所以如果没有 <code>key</code> 在增加一个元素又同时删除一个元素的时候，dom tree并没有发生变化，是不会产生动画效果的。</p>
<h3 id="监听-mousedown-和-touchstart"><a href="#监听-mousedown-和-touchstart" class="headerlink" title="监听 mousedown 和 touchstart"></a>监听 mousedown 和 touchstart</h3><p>mousedown 和 touchstart 处理上会有所不同，但都是用来启动波纹效果的， touch涉及到多点点击的问题，我们一般取第一个即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    handleMouseDown (event) &#123;</div><div class="line">      <span class="comment">// 只监听鼠标左键的点击</span></div><div class="line">      <span class="keyword">if</span> (event.button === <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.start(event, <span class="literal">false</span>)</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    handleTouchStart (event) &#123;</div><div class="line">      event.stopPropagation() <span class="comment">// 防止多个波纹点击组件嵌套</span></div><div class="line">      <span class="keyword">if</span> (event.touches) &#123;</div><div class="line">        <span class="keyword">this</span>.startListeningForScrollAbort(event) <span class="comment">// 启动 touchmove 触发滚动处理</span></div><div class="line">        <span class="keyword">this</span>.startTime = <span class="built_in">Date</span>.now()</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.start(event.touches[<span class="number">0</span>], <span class="literal">true</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="touchmove控制"><a href="#touchmove控制" class="headerlink" title="touchmove控制"></a>touchmove控制</h3><p>当发生touchMove事件是需要判断是否，移动的距离和时间，然后结束小波纹点击小姑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// touchmove 结束波纹控制</span></div><div class="line">  stopListeningForScrollAbort () &#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.handleMove) <span class="keyword">this</span>.handleMove = <span class="keyword">this</span>.handleTouchMove.bind(<span class="keyword">this</span>)</div><div class="line">    <span class="built_in">document</span>.body.removeEventListener(<span class="string">'touchmove'</span>, <span class="keyword">this</span>.handleMove, <span class="literal">false</span>)</div><div class="line">  &#125;,</div><div class="line">  startListeningForScrollAbort (event) &#123;</div><div class="line">    <span class="keyword">this</span>.firstTouchY = event.touches[<span class="number">0</span>].clientY</div><div class="line">    <span class="keyword">this</span>.firstTouchX = event.touches[<span class="number">0</span>].clientX</div><div class="line">    <span class="built_in">document</span>.body.addEventListener(<span class="string">'touchmove'</span>, <span class="keyword">this</span>.handleMove, <span class="literal">false</span>)</div><div class="line">  &#125;,</div><div class="line">  handleTouchMove (event) &#123;</div><div class="line">    <span class="keyword">const</span> timeSinceStart = <span class="built_in">Math</span>.abs(<span class="built_in">Date</span>.now() - <span class="keyword">this</span>.startTime)</div><div class="line">    <span class="keyword">if</span> (timeSinceStart &gt; <span class="number">300</span>) &#123;</div><div class="line">      <span class="keyword">this</span>.stopListeningForScrollAbort()</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> deltaY = <span class="built_in">Math</span>.abs(event.touches[<span class="number">0</span>].clientY - <span class="keyword">this</span>.firstTouchY)</div><div class="line">    <span class="keyword">const</span> deltaX = <span class="built_in">Math</span>.abs(event.touches[<span class="number">0</span>].clientX - <span class="keyword">this</span>.firstTouchX)</div><div class="line">    <span class="comment">// 滑动范围在 &gt; 6px 结束波纹点击效果</span></div><div class="line">    <span class="keyword">if</span> (deltaY &gt; <span class="number">6</span> || deltaX &gt; <span class="number">6</span>) <span class="keyword">this</span>.end()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="计算波纹的位置和大小"><a href="#计算波纹的位置和大小" class="headerlink" title="计算波纹的位置和大小"></a>计算波纹的位置和大小</h3><p>需要从点击处扩散的波纹效果，需要计算波纹元素的大小和位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  getRippleStyle (event) &#123;</div><div class="line">    <span class="keyword">let</span> holder = <span class="keyword">this</span>.$refs.holder</div><div class="line">    <span class="comment">//  这个方法返回一个矩形对象，包含四个属性：left、top、right和bottom。分别表示元素各边与页面上边和左边的距离。</span></div><div class="line">    <span class="keyword">let</span> rect = holder.getBoundingClientRect() </div><div class="line">    <span class="comment">// 获取点击点的位置</span></div><div class="line">    <span class="keyword">let</span> x = event.offsetX</div><div class="line">    <span class="keyword">let</span> y</div><div class="line">    <span class="keyword">if</span> (x !== <span class="literal">undefined</span>) &#123;</div><div class="line">      y = event.offsetY</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      x = event.clientX - rect.left</div><div class="line">      y = event.clientY - rect.top</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 获取最大边长</span></div><div class="line">    <span class="keyword">let</span> max</div><div class="line">    <span class="keyword">if</span> (rect.width === rect.height) &#123;</div><div class="line">      max = rect.width * <span class="number">1.412</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      max = <span class="built_in">Math</span>.sqrt(</div><div class="line">        (rect.width * rect.width) + (rect.height * rect.height)</div><div class="line">      )</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> dim = (max * <span class="number">2</span>) + <span class="string">'px'</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">width</span>: dim,</div><div class="line">      <span class="attr">height</span>: dim,</div><div class="line">      <span class="comment">// 通过margin控制波纹中心点和点击点一致</span></div><div class="line">      <span class="string">'margin-left'</span>: -max + x + <span class="string">'px'</span>,</div><div class="line">      <span class="string">'margin-top'</span>: -max + y + <span class="string">'px'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>由于 <code>touchRipple</code> 内部都是 <strong>position:absolute</strong> 布局，使用时，需要在外部加上 <strong>position:relative</strong> </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// listItem.vue</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">"href"</span> @<span class="attr">mouseenter</span>=<span class="string">"hover = true"</span> @<span class="attr">mouseleave</span>=<span class="string">"hover = false"</span> @<span class="attr">touchend</span>=<span class="string">"hover = false"</span></span></div><div class="line">    @<span class="attr">touchcancel</span>=<span class="string">"hover = false"</span> <span class="attr">class</span>=<span class="string">"mu-item-wrapper"</span> <span class="attr">:class</span>=<span class="string">"&#123;'hover': hover&#125;"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">touch-ripple</span> <span class="attr">class</span>=<span class="string">"mu-item"</span> <span class="attr">:class</span>=<span class="string">"&#123;'mu-item-link': link&#125;"</span> <span class="attr">:center-ripple</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mu-item-media"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"media"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mu-item-content"</span>&gt;</span></div><div class="line">        // ...</div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">touch-ripple</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line"></div><div class="line"><span class="selector-class">.mu-item-wrapper</span> &#123;</div><div class="line">    <span class="attribute">display</span>: block;</div><div class="line">    <span class="attribute">color</span>: inherit;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>到这点击波纹组件就开发完了， 这些代码借鉴了 <a href="https://github.com/JosephusPaye/Keen-UI" target="_blank" rel="external">keen-ui</a> 和 <a href="http://www.material-ui.com/" target="_blank" rel="external">material-ui</a> 的实现方式。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://myronliu.com/2016/09/18/vue/vue_ripple/" data-id="cj7fx25ql001loe775nhv0dng" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/">vue</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/26/wechat/wechat_start/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          微信小程序开发初体验
        
      </div>
    </a>
  
  
    <a href="/2016/09/08/vue/vue_layer/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">关于 vue 弹窗组件的一些感想</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">精神病聚集地</h1>
    <h2 class="blog-subtitle">死宅万岁，bilibili ( ゜- ゜)つロ 乾杯~</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags/vue" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/uicon.jpg">
    <h2 class="author">myron</h2>
    <h3 class="description">一只疯了的前端🐶</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>48</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags/vue"><div><strong>25</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/myronliu347" target="_blank" title="github">
          github
        </a>
      
        <a class="hvr-bounce-in" href="mailto:myronliu347@gmail.com" target="_blank" title="email">
          email
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2016 - 2017 myron<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/tags/vue" title="" class="menuItem">标签</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>